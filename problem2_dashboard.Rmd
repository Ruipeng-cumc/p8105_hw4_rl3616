---
title: "Problem 2 Flexdashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}
library(tidyverse)
library(plotly)
library(flexdashboard)
library(p8105.datasets)

data("instacart")
```

This dashboard explores Instacart orders using three plot types (bar/line/scatter) and highlights reorder behavior and timing patterns. A 50k-row sample is used for speed.

Column {data-width=650}
-----------------------------------------------------------------------

### Total Number of Orders from each Department

```{r}
instacart |> 
  count(department) |> 
  mutate(department = fct_reorder(department, n)) |> 
  plot_ly(
  x = ~department, 
  y = ~n,
  color = ~department,
  type = "bar", 
  colors = "viridis"
) |> 
  layout(
    xaxis = list(title = "Department Name"),
    yaxis = list(title = "Total Number of Orders")
  )

```

Among the 50,000 cases, the produce department has the largest purchase volume, which is related to vegetables and fruits.

Column {data-width=350}
-----------------------------------------------------------------------
### Order Distribution by Time of Day 

```{r}
instacart |>
  group_by(department, order_hour_of_day) |>
  summarise(n_orders = n(), .groups = "drop") |>
  plot_ly(
    x = ~order_hour_of_day,
    y = ~n_orders,
    color = ~department,
    type = "scatter",
    mode = "lines",
    text = ~paste0(
      "Department: ", department,
      "<br>Ordered hour: ", order_hour_of_day,
      "<br>Total orders: ", n_orders),
      hoverinfo = "text"
  ) |> 
  layout(
    xaxis = list(title = "Order Hours"),
    yaxis = list(title = "Number of Orders")
  )
```

At the same time, all purchases are concentrated during the day, with a peak from 10 am to 4 pm and a low point at 4 am.

### Reorder Rate vs Total Orders by aisle

```{r}
aisle_summary <- instacart |>
  group_by(aisle) |>
  summarise(
    total_orders = n(),
    reorder_rate = mean(reordered, na.rm = TRUE),
    .groups = "drop"
  )

plot_ly(
  data = aisle_summary,
  x = ~total_orders,
  y = ~reorder_rate,
  type = "scatter",
  mode = "markers",
  color = ~aisle,
  text = ~paste0(
    "aisle: ", aisle,
    "<br>Total orders: ", total_orders,
    "<br>Reorder rate: ", scales::percent(reorder_rate, 0.1)),
  hoverinfo = "text"
) |>
  layout(
    xaxis = list(title = "Total Orders"),
    yaxis = list(title = "Reorder Rate")
  )

```

