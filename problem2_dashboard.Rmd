---
title: "Instacart Data Analysis"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}
library(tidyverse)
library(plotly)
library(flexdashboard)
library(p8105.datasets)

data("instacart")

instacart_small <- instacart |> 
  sample_n(50000)
```

This dashboard explores Instacart orders using three plot types (bar/line/scatter). A 50k random sample out of 1.38m total samples used in plot.

Column {data-width=650}
-----------------------------------------------------------------------

### Total Number of Orders from each Department

```{r}
instacart_small |> 
  count(department) |> 
  mutate(department = fct_reorder(department, n)) |> 
  plot_ly(
  x = ~department, 
  y = ~n,
  color = ~department,
  type = "bar", 
  colors = "viridis"
) |> 
  layout(
    xaxis = list(title = "Department Name"),
    yaxis = list(title = "Total Number of Orders")
  )

```


Column {data-width=350}
-----------------------------------------------------------------------
### Order Distribution by Time of Day 

```{r}
instacart_small |>
  group_by(department, order_hour_of_day) |>
  summarise(n_orders = n(), .groups = "drop") |>
  plot_ly(
    x = ~order_hour_of_day,
    y = ~n_orders,
    color = ~department,
    type = "scatter",
    mode = "lines",
    text = ~paste0(
      "Department: ", department,
      "<br>Ordered hour: ", order_hour_of_day,
      "<br>Total Orders: ", n_orders),
      hoverinfo = "text"
  ) |> 
  layout(
    xaxis = list(title = "Order Hours"),
    yaxis = list(title = "Total Number of Orders")
    )
```


### Reorder Rate vs Total Orders by aisle

```{r}
instacart_small |>
  group_by(aisle) |>
  summarise(
    total_orders = n(),
    reorder_rate = mean(reordered, na.rm = TRUE),
    .groups = "drop"
  ) |> 
  plot_ly(
    x = ~reorder_rate,
    y = ~total_orders,
    type = "scatter",
    mode = "markers",
    color = ~aisle,
    text = ~paste0(
      "aisle: ", aisle,
      "<br>Reorder rate: ", scales::percent(reorder_rate, 0.1),
      "<br>Total Orders: ", total_orders),
    hoverinfo = "text"
  ) |>
  layout(
    yaxis = list(title = "Total Number of Orders"),
    xaxis = list(title = "Reorder Rate")
  )

```
